const REQUIRED_SHADCN_VARS=["--radius","--background","--foreground","--card","--card-foreground","--popover","--popover-foreground","--primary","--primary-foreground","--secondary","--secondary-foreground","--muted","--muted-foreground","--accent","--accent-foreground","--destructive","--border","--input","--ring"];function checkShadcnSupport(){const e=getComputedStyle(document.documentElement);return{supported:REQUIRED_SHADCN_VARS.every(t=>""!==e.getPropertyValue(t).trim())}}const DEFAULT_FONT_WEIGHTS=["400","500","600","700"];function extractFontFamily(e){if(!e)return null;const t=e.split(",")[0].trim().replace(/['"]/g,"");return["ui-sans-serif","ui-serif","ui-monospace","system-ui","sans-serif","serif","monospace","cursive","fantasy"].includes(t.toLowerCase())?null:t}function buildFontCssUrl(e,t){t=t||DEFAULT_FONT_WEIGHTS;return`https://fonts.googleapis.com/css2?family=${encodeURIComponent(e)}:wght@${t.join(";")}&display=swap`}function loadGoogleFont(e,t){const o=buildFontCssUrl(e,t=t||DEFAULT_FONT_WEIGHTS);if(document.querySelector(`link[href="${o}"]`))return;const n=document.createElement("link");n.rel="stylesheet",n.href=o,document.head.appendChild(n)}function overrideFontClasses(e,t){const o=e.ownerDocument||document,n="tweakcn-font-overrides";let s=o.getElementById(n);s||(s=o.createElement("style"),s.id=n,o.head.appendChild(s));const a=[];t.sans&&a.push(`.font-sans { font-family: ${t.sans} !important; }`),t.serif&&a.push(`.font-serif { font-family: ${t.serif} !important; }`),t.mono&&a.push(`.font-mono { font-family: ${t.mono} !important; }`),s.textContent=a.join("\n")}function overrideShadowClass(e,t,o){const n=e.ownerDocument||document,s="tweakcn-shadow-overrides";let a=n.getElementById(s);a||(a=n.createElement("style"),a.id=s,n.head.appendChild(a));const r=((e,t)=>{const o=e[t],n=o["shadow-color"],s=o["shadow-offset-x"],a=o["shadow-offset-y"],r=o["shadow-blur"],d=o["shadow-spread"],i=parseFloat(o["shadow-opacity"]),c=e=>`color-mix(in srgb, ${n} calc(${i*e} * 100%), transparent)`,E=(e,t)=>`${s} ${e} ${t} ${(parseFloat(d?.replace("px","")??"0")-1).toString()+"px"} ${c(1)}`;return{"shadow-2xs":`${s} ${a} ${r} ${d} ${c(.5)}`,"shadow-xs":`${s} ${a} ${r} ${d} ${c(.5)}`,"shadow-2xl":`${s} ${a} ${r} ${d} ${c(2.5)}`,"shadow-sm":`${s} ${a} ${r} ${d} ${c(1)}, ${E("1px","2px")}`,shadow:`${s} ${a} ${r} ${d} ${c(1)}, ${E("1px","2px")}`,"shadow-md":`${s} ${a} ${r} ${d} ${c(1)}, ${E("2px","4px")}`,"shadow-lg":`${s} ${a} ${r} ${d} ${c(1)}, ${E("4px","6px")}`,"shadow-xl":`${s} ${a} ${r} ${d} ${c(1)}, ${E("8px","10px")}`}})(t,o),d=[];Object.entries(r).forEach(([e,t])=>{d.push(`.${e} { box-shadow: ${t} !important; }`)}),a.textContent=d.join("\n")}function loadThemeFonts(e,t){try{const o={sans:t["font-sans"],serif:t["font-serif"],mono:t["font-mono"]};Object.entries(o).forEach(([e,t])=>{const o=extractFontFamily(t);o&&loadGoogleFont(o,DEFAULT_FONT_WEIGHTS)}),overrideFontClasses(e,o)}catch(e){console.warn("Tweakcn Embed: Failed to load fonts:",e)}}function applyStyleProperty(e,t,o){"string"==typeof o&&o.trim()&&e.style.setProperty(`--${t}`,o)}function updateThemeModeClass(e,t){e.classList.toggle("dark","dark"===t)}function applyThemeStyles(e,t,o){updateThemeModeClass(e,o);const n=t.light||{};for(const[t,o]of Object.entries(n))applyStyleProperty(e,t,o);const s=t.dark;if("dark"===o&&s)for(const[t,o]of Object.entries(s))applyStyleProperty(e,t,o);loadThemeFonts(e,n),overrideShadowClass(e,t,o)}function applyTheme(e){const t=document.documentElement;if(!t||!e||!e.styles)return void console.warn("Tweakcn Embed: Missing root element or theme styles.");const{currentMode:o,styles:n}=e;applyThemeStyles(t,n,o)}function sendMessageToParent(e){if(window.parent&&window.parent!==window)try{window.parent.postMessage(e,"*")}catch(e){console.warn("Tweakcn Embed: Failed to send message to parent:",e)}}const TWEAKCN_MESSAGE={PING:"TWEAKCN_PING",PONG:"TWEAKCN_PONG",CHECK_SHADCN:"TWEAKCN_CHECK_SHADCN",SHADCN_STATUS:"TWEAKCN_SHADCN_STATUS",THEME_UPDATE:"TWEAKCN_THEME_UPDATE",THEME_APPLIED:"TWEAKCN_THEME_APPLIED",EMBED_LOADED:"TWEAKCN_EMBED_LOADED",EMBED_ERROR:"TWEAKCN_EMBED_ERROR"};(()=>{"use strict";if(window.tweakcnEmbed)return;const e=e=>{if(e.source!==window.parent)return;if(!e.data||"string"!=typeof e.data.type)return;if(!["https://tweakcn.com","http://localhost:3000"].includes(e.origin))return void sendMessageToParent({type:TWEAKCN_MESSAGE.EMBED_ERROR,payload:{error:"Origin not allowed. Preview failed to establish the connection with tweakcn."}});const{type:t,payload:o}=e.data;switch(t){case TWEAKCN_MESSAGE.PING:sendMessageToParent({type:TWEAKCN_MESSAGE.PONG});break;case TWEAKCN_MESSAGE.CHECK_SHADCN:const e=checkShadcnSupport();sendMessageToParent({type:TWEAKCN_MESSAGE.SHADCN_STATUS,payload:e});break;case TWEAKCN_MESSAGE.THEME_UPDATE:o&&o.themeState&&(applyTheme(o.themeState),sendMessageToParent({type:TWEAKCN_MESSAGE.THEME_APPLIED}))}};window.addEventListener("message",e);const t=()=>{try{sendMessageToParent({type:TWEAKCN_MESSAGE.NAVIGATION_UPDATE,payload:{url:window.location.href}})}catch(e){}},o=()=>{const e=history.pushState,o=history.replaceState;history.pushState=function(){const o=e.apply(this,arguments);return t(),o},history.replaceState=function(){const e=o.apply(this,arguments);return t(),e}};try{o()}catch(e){}window.addEventListener("popstate",t),window.addEventListener("hashchange",t),window.tweakcnEmbed={initialized:!0,version:"1.0.0",destroy:()=>{window.removeEventListener("message",e),delete window.tweakcnEmbed}},sendMessageToParent({type:TWEAKCN_MESSAGE.EMBED_LOADED}),t()})();